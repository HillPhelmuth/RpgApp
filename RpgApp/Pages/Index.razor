@page "/"
@using System.Net.Http.Json
@using System.ComponentModel
@using RpgApp.Shared
@inject HttpClient Http

<MatTabGroup @bind-ActiveIndex="indexTab">
   
        <MatTab Label="Generate Character">
            <GamePlayPrimary />
        </MatTab>
        <MatTab Label="Data Query Testing">
            <TestQueries />
        </MatTab>
        <MatTab Label="MyLayout">
            <LayoutMyCss />
        </MatTab>
        <MatTab Label="Test Styles">
        </MatTab>
        <MatTab Label="Test Page">
            @if (AppState.CurrentPlayer == null)
            {
                <MatH3 Style="color:red">Error!</MatH3>
                <MatH5>Visit Query tester page and Select a default player before returning</MatH5>
            }
            else
            {
                <TestPage />
            }

        </MatTab>
        <MatTab Label="D&D API Dev Tools">
            @*<CheatCreate/>*@ <MatH3>Moving to it's own project</MatH3>
        </MatTab>
</MatTabGroup>
@code
{
    protected int indexTab;
    [CascadingParameter(Name = "AppState")]
    public AppStateManager AppState { get; set; }
    protected override Task OnInitializedAsync()
    {
        AppState.PropertyChanged += UpdateTab;
        return base.OnInitializedAsync();
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            var allData = await Http.GetFromJsonAsync<AllAppData>($"{AppConstants.ApiUrl}/AllAppData");
            AppState.AllEquipment = allData.Equipment;
            AppState.AllMonsters = allData.Monsters;
            AppState.AllSkills = allData.Skills;
        }
        await base.OnAfterRenderAsync(firstRender);
    }

    protected async void UpdateTab(object sender, PropertyChangedEventArgs e)
    {
        if (e.PropertyName != "IndexTab") return;
        indexTab = AppState.IndexTab;
        await InvokeAsync(StateHasChanged);
    }
    
}
